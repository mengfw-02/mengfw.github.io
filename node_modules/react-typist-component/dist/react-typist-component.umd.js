(function(r,k){typeof exports=="object"&&typeof module<"u"?module.exports=k(require("react")):typeof define=="function"&&define.amd?define(["react"],k):(r=typeof globalThis<"u"?globalThis:r||self,r["react-typist-component"]=k(r.React))})(this,function(r){"use strict";const w=(n=>n&&typeof n=="object"&&"default"in n?n:{default:n})(r),P=n=>n==null,N=(n,o)=>{if(typeof o!="string"){const{children:t,...s}=o.props;o.key||(s.key="typist-cursor"),o=w.default.cloneElement(o,s,t)}const u=t=>{if(!t)return t;if(t.length===0)return[o];const s=t[t.length-1];if(typeof s=="string")return[...t,o];const{children:l,...f}=s.props;if(P(l))return[...t,o];const e=u(l),i=w.default.cloneElement(s,f,e);return[...t.slice(0,-1),i]};return u(n)},Y=()=>{},B=n=>n.split(""),A=n=>null,T=n=>null,F=(n,o)=>{let u=0;const t=s=>r.Children.map(s,f=>{if(u>=o.length)return null;if(r.isValidElement(f)){if(f.type===A||f.type===T)return null;const{children:e,...i}=f.props;if(P(e))return o[u++];const a=t(e);return a&&a.length===0?null:r.cloneElement(f,i,a)}return typeof f=="string"||typeof f=="number"?o[u++]:null});return t(n)},x=({children:n})=>w.default.createElement(w.default.Fragment,null,n);function O(n,o){const u=[],t=[];let s=!1;const l=f=>{r.Children.forEach(f,e=>{if(r.isValidElement(e)){if(e.type===T)return;if(e.type===A){let p=e.props.count;for(;p--;){let m=t.length-1,E=t[m];for(;E===null&&m>0;)m-=1,E=t[m];if(E===null)break;if(typeof E=="object"&&(t[m]=null),typeof E=="string"){const g=o(E).slice(0,-1).join("");t[m]=g||null}u.push([...t])}return}if(e.type===x){s=!0,r.Children.forEach(e.props.children,l),s=!1;return}if(P(e.props.children)){t.push(e),u.push([...t]);return}r.Children.forEach(e.props.children,l)}const i=(()=>{if(typeof e=="number")return e.toString(10);if(typeof e=="string")return e})();if(i===void 0)return;if(s){t.push(i),u.push([...t]);return}const a=o(i),y=t.length;for(let p=1;p<=a.length;p++){const m=a.slice(0,p).join("");t[y]=m,u.push([...t])}})};return l(n),u.map(f=>F(n,f))}const L=n=>({type:"TYPE_TOKEN",payload:n}),V=n=>({type:"BACKSPACE",payload:n}),M=n=>({type:"DELAY",payload:n}),q=n=>({type:"PASTE",payload:n}),z=(n,o)=>{const u=[];let t=!1,s=0;const l=f=>{r.Children.forEach(f,e=>{if(r.isValidElement(e)){if(e.type===A){const y=e.props.count,p=y>s?s:y;s-=p,u.push(V(p));return}if(e.type===T){u.push(M(e.props.ms));return}if(e.type===x){t=!0,r.Children.forEach(e.props.children,l),t=!1;return}if(P(e.props.children)){s+=1,u.push(L(e));return}r.Children.forEach(e.props.children,l)}const i=(()=>{if(typeof e=="number")return e.toString(10);if(typeof e=="string")return e})();if(i===void 0)return;if(t){s+=o(i).length,u.push(q(i));return}const a=o(i);s+=a.length,a.forEach(y=>{u.push(L(y))})})};return l(n),u};return Object.assign(({cursor:n,disabled:o=!1,restartKey:u,children:t,splitter:s=B,typingDelay:l=75,backspaceDelay:f=l,onTypingDone:e,startDelay:i=0,finishDelay:a=0,loop:y=!1,pause:p=!1})=>{const[m,E]=r.useState([]),[j,g]=r.useState(-1),b=r.useRef(Y),v=r.useRef(y),_=r.useRef(p),I=r.useCallback(d=>new Promise((h,c)=>{const S=typeof d=="number"?d:d(),C=setTimeout(h,S);b.current=()=>{clearTimeout(C),c()}}),[]),G=r.useCallback(()=>new Promise((d,h)=>{const c=setInterval(()=>{_.current||(clearInterval(c),d())});b.current=()=>{clearInterval(c),h()}}),[]),H=r.useCallback(()=>new Promise((d,h)=>{const c=setInterval(()=>{v.current&&(clearInterval(c),d())});b.current=()=>{clearInterval(c),h()}}),[]);r.useEffect(()=>{v.current=y,_.current=p},[y,p]),r.useEffect(()=>{const d=O(t,s);if(E(d),o){g(d.length-1);return}return(async()=>{try{do{g(-1);const h=z(t,s);i>0&&await I(i);for(const{type:c,payload:S}of h)if(p&&await G(),c==="TYPE_TOKEN")g(C=>C+1),await I(l);else if(c==="BACKSPACE"){let C=S;for(;C--;)g(J=>J+1),await I(f)}else c==="PASTE"?g(C=>C+1):c==="DELAY"&&await I(S);e==null||e(),a>0&&await I(a),v.current||await H()}while(v.current)}catch{}})(),()=>{b.current()}},[u,o]);const K=m[j];return w.default.createElement(w.default.Fragment,null,n?N(K,n):K)},{Delay:T,Backspace:A,Paste:x})});
